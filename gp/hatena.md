# はじめに

[ガウス過程と機械学習](https://www.kspub.co.jp/book/detail/1529267.html)を読んだ．
この記事では自分の理解のために，ガウス過程を実装する．
自分の今のところの理解では，$N_1$個の入力と出力のペア$(x_1^{(1)}, y_1^{(1)}),\dots ,(x_{1}^{(N_1)}, y_{1}^{(N_1)})$と，出力を求めたい$N_2$個の入力$(x_2^{(1)}, y_2^{(1)}),\dots ,(x_{2}^{(N_2)}, y_{2}^{(N_2)})$があるとき，ガウス過程では以下のようにして出力$y_2$の分布を求める．

1. 観測$y_1\in \mathbb R^{N_1}$および$y_2 \in \mathbb R^{N_2}$がある1つの多変量ガウス分布に従うとする．$y = [y_1, y_2]^\top$, $x = [x_1, x_2]^\top$とするとき，$y \sim \mathcal N (\mu(x), \Sigma(x))$．ここで，平均$\mu$および分散$\Sigma$は$x$の関数．
1. $y_1$が得られたときの，$y_2$の条件付き確率分布を求める．

以下では，平均気温の変動を例に実際にガウス過程を書いてみる．

# 気温変動の例

この記事では例として以下のような愛知県の気温の変動について考える．
データは気象庁のHPから入手できる．
データをそのまま使っても良いが，ガウス過程の例題としては観測のタイミングがまちまちであるほうが面白そうなので，データをランダムに間引いた．

はじめに今日の気温から明日の気温の確率分布を予測する問題を考える．
平均気温は前後の日の気温と相関していそうであり，また，なんとなくガウス分布的な分布をしていそうな気がするので，ガウス過程でモデル化出来そうである．
とりあえず2日間の気温の関係をプロットしてガウス過程でモデル化しても良さそうかどうかを考える．
ある日の気温を$y_1$，次の日の気温を$y_2$とすると以下のような散布図を書くことができる．


散布図より実際に今日の気温と明日の気温が相関していることがわかる．
また，全体的に気温の分布はガウス分布になっていることもわかる．
以上から，今日と明日の気温の分布は多変量ガウス分布によってモデル化することができそうである．つまり
$p(y_1, y_2) = \mathcal{N}(\bar{\boldsymbol{y}}, \Sigma)$，ここで，$\bar{\boldsymbol{y}}\in \mathbb R^2$は年間の気温の平均$\bar{y}$を並べたベクトルであり，$\Sigma$は分散共分散行列である．

分散共分散行列の成分$\Sigma{11}, \Sigma{22}$はともに年間の気温の分散であり，データより$\Sigma{11}, \Sigma{22} = TODO$．
また，$\Sigma{12}$，$\Sigma{21}$は$y1$，$y_2$の共分散であり，同様にデータより$\Sigma{12} = \Sigma_{21} = TODO$であった．

先ほどの散布図に確率密度の等高線を重ねてみると以下のような図(右)が得られた．
比較のためにデータ点を使って，カーネル密度推定した結果の等高線図を左に示す．
図から先ほどの多変量ガウス分布によって，だいたい(基準なし)モデル化できているように思える．


## 多変量ガウス分布の条件付き確率
$y_1$と$y_2$の同時分布をモデル化することはできた．
次にもともと考えたかった今日の気温$y_1$が観測されたときの明日の気温$y_2$の確率，つまり，条件付き確率$p(y_2| y_1) $を考える．
わかりやすさのために，先ほどの同時分布を以下のように少し書き換える．
$p(y_1, y_2) = \mathcal{N}(\bar{\boldsymbol{y}}, \Sigma) = \mathcal{N}(\boldsymbol{0}, \Sigma) + \bar{\boldsymbol{y}}$
平均が\boldsymbol{0}のとき，2次元のガウス分布の確率密度関数は以下のように与えられる[参考]．
$\mathhcal{N}(\boldsymbol{y} | \boldsymbol{0}, \Sigma) = \frac{1}{2 \sqrt{2 \pi} \sqrt{|\Sigma|}}} \exp(-\frac{1}{2} y^\top \Sigma y)$ TODO
よって，$y_1$が観測されたとき，$y_2$の条件付き確率は
$p(y2 | y_1) = \mathcal{N}(\Sigma{21}\Sigma{11}^{-1}y_1, \Sigma{22} - \Sigma{21}\Sigma{11^{-1}}\Sigma{12})$
で与えられる．

プロットでこれが結局どのような分布なのかを確認する．
例として，今日の気温が30℃，20℃，10℃であったときのp(y_2|y_1)を以下に示す．
明日の気温が今日の気温を反映したガウス分布によってモデル化されていることがわかる．




ガウス過程
ここまでは昨日の気温と今日の気温という2つの変数のみを考えてきた．
一方で，一昨日の気温やその前の日の気温も今日の気温と関連していると思える．
また，これらの関連度合いは徐々に小さくなっていくことが予想できる．

これらを統一的にモデル化するために，現在得られている全ての気温(3年分)と明日の気温の同時分布p(Y, y)を上と同じように多変量ガウス分布によってモデル化し，今日までの気温から明日の気温の条件付き確率$p(y|Y)$を求める方法がある．
これがガウス過程回帰である(たぶん)．

2つの変数だけ考えていた場合と同様にモデル化するためには，各日の気温間の共分散を考える必要がある．
今扱っている気温の例では，これも統計量を求めることができるが，ここでは日付の差($x$)の関数$k(x)$によって共分散を記述できるとする．






上と同じようにモデル化するためには，各気温間の共分散を考える必要がある．今回はデータが得られているので，1つずつデータからモデル化しても良いが，ここでは




